import{r as i,j as e}from"./vendor-Cz2k0cIx.js";import{s as u}from"./index-Blx0RmKp.js";async function _(n){return u.from("batch_tracking").insert([n])}async function m(n){return u.from("batch_tracking").select("*").eq("batch_number",n).single()}async function f(n,a){return u.from("batch_tracking").update(a).eq("batch_number",n)}async function y(n){const a=u.from("batch_tracking").select("*");return n?a.eq("farmer_id",n):a}async function C(n,a){const{data:c}=await m(n),r=(c==null?void 0:c.transport_history)||[];return f(n,{transport_history:[...r,a]})}async function x(n){const{data:a}=await m(n);return(a==null?void 0:a.transport_history)||[]}const k=({farmerId:n})=>{const[a,c]=i.useState([]),[r,g]=i.useState(null),[s,o]=i.useState({product_type:"",quantity:0,origin:"",destination:""}),[h,d]=i.useState(""),[j,p]=i.useState([]);i.useEffect(()=>{y(n).then(({data:t})=>c(t||[]))},[n]);const b=async()=>{await _({...s,farmer_id:n}),y(n).then(({data:t})=>c(t||[])),o({product_type:"",quantity:0,origin:"",destination:""})},v=async t=>{g(t);const l=await x(t.batch_id);p(l)},B=async()=>{if(r){await C(r.batch_id,{text:h,date:new Date().toISOString()});const t=await x(r.batch_id);p(t),d("")}};return e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Batch Tracking"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Create New Batch"}),e.jsx("input",{type:"text",placeholder:"Product Type",value:s.product_type,onChange:t=>o({...s,product_type:t.target.value})}),e.jsx("input",{type:"number",placeholder:"Quantity",value:s.quantity,onChange:t=>o({...s,quantity:Number(t.target.value)})}),e.jsx("input",{type:"text",placeholder:"Origin",value:s.origin,onChange:t=>o({...s,origin:t.target.value})}),e.jsx("input",{type:"text",placeholder:"Destination",value:s.destination,onChange:t=>o({...s,destination:t.target.value})}),e.jsx("button",{onClick:b,children:"Create Batch"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Your Batches"}),e.jsx("ul",{children:a.map(t=>e.jsx("li",{children:e.jsxs("button",{onClick:()=>v(t),children:[t.product_type," (",t.status,")"]})},t.batch_id))})]}),r&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold",children:"Batch Journey"}),e.jsx("ul",{children:j.map((t,l)=>e.jsxs("li",{children:[t.text," - ",t.date]},l))}),e.jsx("input",{type:"text",placeholder:"Add event",value:h,onChange:t=>d(t.target.value)}),e.jsx("button",{onClick:B,children:"Add Event"})]})]})};export{k as BatchTrackingPage};
